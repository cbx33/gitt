<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Git In The Trenches</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<link type="text/css" href="menu.css" rel="stylesheet" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-228354-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<table width="1000" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td class="logo"><a href="index.html"><img src="images/git_logo_new.png" alt="Git In The Trenches" height="61" border="0"></a></td>
            <td class="nav">
				<a href="index.html">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="download.html">Download Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="intro.html">Read Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="http://github.com/cbx33/gitt">Source</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="feedback.html">Feeback</a>
			</td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td class="main_content_pad"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="309"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="subnav">
				<strong>Introduction</strong><br>
&bull;&nbsp;&nbsp;<a href="intro.html">How this book works</a><br>
<div class="divider"></div>
<strong>Setting up</strong><br>
&bull;&nbsp;&nbsp;<a href="setup.html">Making sure you have everything</a><br>
<div class="divider"></div>
<strong>Week 1</strong><br>
<span>&bull; Day 1 </span> - <a href="chap1-1.html"> "Things need to change"</a><br>
<span>&bull; Day 3 </span> - <a href="chap1-2.html"> "A possible solution"</a><br>
<span>&bull; Day 4 </span> - <a href="chap1-3.html"> "A decision is reached"</a><br>
<span>&bull; Day 5 </span> - <a href="chap1-4.html"> "Working like a team"</a><br>
<div class="divider"></div>
<strong>After Hours Week 1</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours1-1.html">"History Lesson"</a><br>
<div class="divider"></div>
<strong>Week 2</strong><br>
<span>&bull; Day 1 </span> - <a href="chap2-1.html"> "We are coders, we use Git!"</a><br>
<span>&bull; Day 2 </span> - <a href="chap2-2.html"> "Making commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap2-3.html"> "Let's do this right, not fast"</a><br>
<span>&bull; Summary </span> - <a href="chap2-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 2</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours2-1.html">"A Little Of Git's Internals"</a><br>
<div class="divider"></div>
<strong>Week 3</strong><br>
<span>&bull; Day 1 </span> - <a href="chap3-1.html"> "How do I see what's going on?"</a><br>
<span>&bull; Day 2 </span> - <a href="chap3-2.html"> "But I need more information"</a><br>
<span>&bull; Day 3 </span> - <a href="chap3-3.html"> "What actually changed?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap3-4.html"> "Finding a good reference point"</a><br>
<span>&bull; Day 5 </span> - <a href="chap3-5.html"> "Putting things back again"</a><br>
<span>&bull; Summary </span> - <a href="chap3-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 3</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours3-1.html">"A Closer Look At Diffs and Tags"</a><br>
<div class="divider"></div>
<strong>Week 4</strong><br>
<span>&bull; Day 1 </span> - <a href="chap4-1.html"> "We're getting somewhere"</a><br>
<span>&bull; Day 2 </span> - <a href="chap4-2.html"> "Branches galore"</a><br>
<span>&bull; Day 3 </span> - <a href="chap4-3.html"> "Tricking the twigs"</a><br>
<span>&bull; Day 4 </span> - <a href="chap4-4.html"> "I pressed delete..."</a><br>
<span>&bull; Day 5 </span> - <a href="chap4-5.html"> "Conflicting information"</a><br>
<span>&bull; Summary </span> - <a href="chap4-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 4</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-1.html">"Merge merge merge"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-2.html">"Grepping your life away"</a><br>
<div class="divider"></div>
<strong>Week 5</strong><br>
<span>&bull; Day 1 </span> - <a href="chap5-1.html"> "This isn't working for me John"</a><br>
<span>&bull; Day 2 </span> - <a href="chap5-2.html"> "Back to logging"</a><br>
<span>&bull; Day 4 </span> - <a href="chap5-3.html"> "Advanced Techniques"</a><br>
<span>&bull; Summary </span> - <a href="chap5-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 5</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours5-1.html">"Splitting up commits the easy way"</a><br>
<div class="divider"></div>
<strong>Week 6</strong><br>
<span>&bull; Day 1 </span> - <a href="chap6-1.html"> "My private little stash"</a><br>
<span>&bull; Day 2 </span> - <a href="chap6-2.html"> "What?! No backup?"</a><br>
<span>&bull; Day 3 </span> - <a href="chap6-3.html"> "Is this clone for real?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap6-4.html"> "Help I'm no longer up to date?"</a><br>
<span>&bull; Day 5 </span> - <a href="chap6-5.html"> "I'm putting my foot down"</a><br>
<span>&bull; Summary </span> - <a href="chap6-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 6</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-1.html">"Tug of war"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-2.html">"Referring to objects"</a><br>
<div class="divider"></div>
<strong>Week 7</strong><br>
<span>&bull; Day 1 </span> - <a href="chap7-1.html"> "Networking with a difference"</a><br>
<span>&bull; Day 2 </span> - <a href="chap7-2.html"> "Now let's work together"</a><br>
<span>&bull; Day 3 </span> - <a href="chap7-3.html"> "Rebasing our commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap7-4.html"> "Starting to get rebased"</a><br>
<span>&bull; Day 5 </span> - <a href="chap7-5.html"> "I could rebase the world"</a><br>
<span>&bull; Summary </span> - <a href="chap7-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 7</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours7-1.html">"Network Communicating"</a><br>
<div class="divider"></div>
<strong>Week 8</strong><br>
<span>&bull; Day 1 </span> - <a href="chap8-1.html"> "Give a man a patch"</a><br>
<span>&bull; Day 2 </span> - <a href="chap8-2.html"> "Looking for problems"</a><br>
<span>&bull; Day 3 </span> - <a href="chap8-3.html"> "Filtered repos"</a><br>
<span>&bull; Day 4 </span> - <a href="chap8-4.html"> "Let's make a library"</a><br>
<span>&bull; Day 5 </span> - <a href="chap8-5.html"> "Shhh....we're in a library"</a><br>
<span>&bull; Summary </span> - <a href="chap8-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 8</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours8-1.html">"Fishing for beginners"</a><br>
<div class="divider"></div>
<strong>A little extra help</strong><br>
&bull;&nbsp;&nbsp;<a href="chap9-1.html">Taking things further</a><br>
&bull;&nbsp;&nbsp;<a href="chap9-2.html">The end of the journey</a><br>
<div class="divider"></div>

				
				<td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table>              <h1>&nbsp;</h1>
              </td>
            <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="read_content">
<h1>Week 7</h1><h2>Day 4 - "Starting to get rebased"</h2>
<h3>Using rebase with branches</h3>
Up until now we have used <code class="ncode">git rebase</code> to work on our current branch, modifying a few things here and there.
This is actually one of the simplest things that rebase can perform, and as hinted to in our workflow design, we can actually use <code class="ncode">git rebase</code> to perform something called <em>Continuous Integration</em>.<br><br>As we stated before, one of the most interesting uses of using <code class="ncode">git rebase</code> is to update your branch with changes from another, whilst keeping your development intact.
The great part about it is that there is no messy merging, your commits appear at the end of the tree which makes things nice and tidy.
Let us go back to our example and add some more commits to the <strong>master</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout master</strong><br/>
Switched to branch 'master'<br/>
<strong>john@satsuki:~/coderepo$ touch cont_dev</strong><br/>
<strong>john@satsuki:~/coderepo$ echo "New info" &gt;&gt; cont_dev</strong><br/>
<strong>john@satsuki:~/coderepo$ git add cont_dev</strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Start new dev'</strong><br/>
[master 1968324] Start new dev<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
 create mode 100644 cont_dev<br/>
<strong>john@satsuki:~/coderepo$ echo "A cool function" &gt;&gt; cont_dev</strong><br/>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Finished new dev'</strong><br/>
[master f8d5100] Finished new dev<br/>
 1 files changed, 1 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$ git logg -n5</strong><br/>
* f8d5100 (HEAD, master) Finished new dev<br/>
* 1968324 Start new dev<br/>
| * 4d91aab (wonderful) Updated another file again<br/>
| * 1ffe37f Updated another file with 2 edits<br/>
|/<br/>
* 1c3206a Added a new file<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>You may have noticed that we seem to have introduced a new command here called <code class="ncode">git logg</code>.
The command seems to do exactly the same as our <code class="ncode">git log --graph --pretty=oneline --all --abbrev-commit --decorate</code> command.
For more information about what we have done here, see the callout called <strong>An alias in our midst</strong>.<br><div id="calloutblock"><h3>Information - An alias in our midst</h3>
Some times, you will get tired of typing the same old long string of parameters into Git.
Though some people tend to frown upon using them, aliases can significantly increase your productivity, by allowing you to shortcut annoyingly long commands.
You may have noticed our <code class="ncode">git log --graph --pretty=oneline --all --abbrev-commit --decorate</code> command from before.
It is awfully long.
Let us create an alias called <code class="ncode">git logg</code>.<br><br>There are multiple ways to do this, but we are going to get a little down and dirty and edit the <code class="ncode">.git/config</code> file in our repository.
You will find a few <em>stanzas</em> which start like this <code class="ncode">[core]</code>, followed by a number of lines.
If you don't already have one, use the editor to add <code class="ncode">[alias]</code> at the end of the file, so that your file has a section looking like the following.<br><div id="codeblock"><code>[alias]<br/>
        logg = log --graph --pretty=oneline --all --abbrev-commit --decorate<br/>
</code></div><br>Once saved, we can use <code class="ncode">git logg</code> just like any other Git command.
As you can see from the example in the text, we can even append more parameters that the parent command <code class="ncode">git log</code> usually accepts.
So we can do things like <code class="ncode">git logg -n5</code> to get only five entries.
</div><br>So we have two development trees, our <strong>master</strong> which is what our development work is based on, and our <strong>wonderful</strong> branch, which is where we are performing our development work.
The task now is to update the <strong>wonderful</strong> branch, with all of the changes that have taken place in <strong>master</strong>.
To do this, we use the <code class="ncode">git rebase</code> tool once more, but this time in a slightly different manner.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout wonderful</strong><br/>
Switched to branch 'wonderful'<br/>
<strong>john@satsuki:~/coderepo$ git rebase master</strong><br/>
First, rewinding head to replay your work on top of it...<br/>
Applying: Updated another file with 2 edits<br/>
Applying: Updated another file again<br/>
<strong>john@satsuki:~/coderepo$ git logg -n5</strong><br/>
* 5167cce (HEAD, wonderful) Updated another file again<br/>
* 551086e Updated another file with 2 edits<br/>
* f8d5100 (master) Finished new dev<br/>
* 1968324 Start new dev<br/>
* 1c3206a Added a new file<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>We started by checking out the <strong>wonderful</strong>.
With the <code class="ncode">git rebase master</code> command, we told Git to take all of the changes in our topic branch called <strong>wonderful</strong>, and replay them on top of the new <strong>master</strong>.
We could have also used the command <code class="ncode">git rebase master topic</code> which would actually have done the original <code class="ncode">git checkout</code> for us.<br><br>Notice again, that our commit IDs have changed.
The contents, in this case, remain identical, as we have not hit upon any conflicts during out rebase.
If we had, we would have to have resolved that, and then run the <code class="ncode">git rebase --continue</code>, or <code class="ncode">git rebase --abort</code> to abort the rebase completely.<br><br>So, our wonderful branch is now sat on top of the new development changes and instead of having two diverging branch heads, we now have a single branch which <strong>wonderful</strong> extends from.<br><div id="trenchblock"><strong>In the trenches...</strong><br>
"Martha!" Simon shouted across the office at the seemingly new Git expert.
"HELP!!"<br><br>Martha got up from her seat.
It hadn't been fifteen minutes since she had shown Simon how to rebase branches and now he was calling her again.
At first she had tried to ignore it, but the waves of SOS had plunged through the headphones and reverberated round her head one too many times.
She placed the music on hold and put the headphones on the desk.<br><br>"What's up Simon?" she asked, smiling at John who was chuckling to himself at his desk.<br><br>"Well, I kinda rebased, but I wish I hadn't now, cos it all went wrong. How can I go back?"
</div><br>It's an interesting question.
How would we move back again? We have rewritten history, how could we possibly hope to go back again? We have discussed before how most things in Git are never really immediately gone, even if we delete them.
Does this apply here too? Of course it does.
Remember that a branch is really just defined by which commit the HEAD points to.
Let us draw a few diagrams to show how the tree of commits looks before and after our rebase.<br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w7-d5.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 5</strong><br>Our repository before the rebase</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br>Figure 5 shows our repository before we perform the rebase.
We can quite clearly see that there are two branches, diverging from the common ancestor, <strong>1c3206a</strong>.
In Figure 6, we see the repository after the rebase has taken place.
Notice that the two commits that <em>were</em> forming the <strong>wonderful</strong> branch are now coloured in grey.<br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w7-d6.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 6</strong><br>Our repository after the rebase</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br>The grey commits are no longer referenced.
No branche HEADs point to them, and no other commits rely upon them.
In short they have been orphaned, or are left <em>dangling</em>.
A dangling commit has no references left pointing to it.
Remember each commit relies on its parent.
Therefore because the HEAD of <strong>wonderful</strong> now points to <strong>5167cce</strong>, and that in turn points to <strong>551086e</strong>.
The original commit line is unchanged.<br><br>Thinking back to previous weeks, we have had a similar situation before.
If we know the commit ID that we wish to return to, there really is nothing more complicated than issuing a <code class="ncode">git reset</code>.
The only tricky part is knowing the commit you wish to return to.<br><br>We do however have a weapon at our disposal.
The <code class="ncode">git log</code> tool can be used with the <code class="ncode">-g</code>.
This parameter forces the Git to refer to the <em>reflog</em> for entries, instead of traversing the usualy tree.
If you remember, the reflog is our key to seeing what happened in the past.
It holds a list of all the previous HEADs of each branch.
By supplying the branch name, we can see everything that happened to the <strong>wonderful</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log -g wonderful -n2</strong><br/>
commit 5167cce7864ca71420ce5dc37ec9b3f931727db3<br/>
Reflog: wonderful@{0} (John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;)<br/>
Reflog message: rebase finished: refs/heads/wonderful onto f8d5100142b43ffaba9bb<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Wed Jul 6 09:30:40 2011 +0100<br/>
<br/>
    Updated another file again<br/>
<br/>
commit 4d91aab57aaad020e62486805e25d0d6f06fdc3e<br/>
Reflog: wonderful@{1} (John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;)<br/>
Reflog message: rebase -i (finish): refs/heads/wonderful onto 1c3206a<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Wed Jul 6 09:30:40 2011 +0100<br/>
<br/>
    Updated another file again<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>As you can see, the log shows that we recently completed two rebases.
The first resulted in an ID of <strong>4d91aab</strong> and the second resulted in <strong>5167cce</strong>.
As it happens, we are trying to get back to the end of that first rebase, before we ran the second.
So if we run the reset against that ID, we should return to our pre-rebased state.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git reset --hard 4d91aab</strong><br/>
HEAD is now at 4d91aab Updated another file again<br/>
<strong>john@satsuki:~/coderepo$ git logg -n5</strong><br/>
* f8d5100 (master) Finished new dev<br/>
* 1968324 Start new dev<br/>
| * 4d91aab (HEAD, wonderful) Updated another file again<br/>
| * 1ffe37f Updated another file with 2 edits<br/>
|/<br/>
* 1c3206a Added a new file<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>As you can see, even though the commit messages are identical, the history of them differs.
Obviously now, it is our rebased version which is left dangling and if it continues to go unused, it will eventually be deleted.
Of course it is also possible to create a branch to point to the dangling commit.
In this way it would never get deleted.
Let us just see how we could achieve this.<br><br>Armed with the knowledge that the commit we are looking for is <strong>5167cce</strong>, we can run the <code class="ncode">git branch</code> command and specify a starting point.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git branch keeprebase 5167cce</strong><br/>
<strong>john@satsuki:~/coderepo$ git branch -v</strong><br/>
  keeprebase 5167cce Updated another file again<br/>
  master     f8d5100 Finished new dev<br/>
* wonderful  4d91aab Updated another file again<br/>
  zaney      7cc32db Made another awesome change<br/>
<strong>john@satsuki:~/coderepo$ git logg -n7</strong><br/>
* 5167cce (keeprebase) Updated another file again<br/>
* 551086e Updated another file with 2 edits<br/>
* f8d5100 (master) Finished new dev<br/>
* 1968324 Start new dev<br/>
| * 4d91aab (HEAD, wonderful) Updated another file again<br/>
| * 1ffe37f Updated another file with 2 edits<br/>
|/<br/>
* 1c3206a Added a new file<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w7-d7.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 7</strong><br>Our repository after the recovery</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br>Notice our branch is now created and looking at the log, it contains the same two commits and the tree looks as we would expect.
We have our <code class="ncode">another_file</code> updates in both branches.<br><br><table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><p align="left"><a href="chap7-3.html"><img src="images/prev.png" alt="Previous Day" height="29" border="0"></a></p></td>
						<td><p align="right"><a href="chap7-5.html"><img src="images/next.png" alt="Next Day" height="29" border="0"></a></p></td>
					</tr>
				</table>                  </td>
                <td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table></td>
            </tr>
          </table>
		</td>
      </tr>
      <tr>
        <td class="foot"><a href="index.html">home</a> | <a href="download.html">download</a> | <a href="read.html">read now</a> | <a href="source.html">source</a> | <a href="feedback.html">feedback</a> | <a href="legal.html">legal stuff</a><br>
        </td>
      </tr>
    </table></td>
  </tr>
</table>
</body>
</html>
