<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Git In The Trenches</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<link type="text/css" href="menu.css" rel="stylesheet" />
	<script type="text/javascript" src="jquery.js"></script>
</head>

<body>
<table width="1000" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td class="logo"><a href="index.html"><img src="images/git_logo_new.png" alt="Git In The Trenches" height="61" border="0"></a></td>
            <td class="nav">
				<a href="index.html">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="download.html">Download Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="intro.html">Read Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="http://github.com/cbx33/gitt">Source</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="feedback.html">Feeback</a>
			</td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td class="main_content_pad"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="309"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="subnav">
				<strong>Introduction</strong><br>
&bull;&nbsp;&nbsp;<a href="intro.html">How this book works</a><br>
<div class="divider"></div>
<strong>Setting up</strong><br>
&bull;&nbsp;&nbsp;<a href="setup.html">Making sure you have everything</a><br>
<div class="divider"></div>
<strong>Week 1</strong><br>
<span>&bull; Day 1 </span> - <a href="chap1-1.html"> "Things need to change"</a><br>
<span>&bull; Day 3 </span> - <a href="chap1-2.html"> "A possible solution"</a><br>
<span>&bull; Day 4 </span> - <a href="chap1-3.html"> "A decision is reached"</a><br>
<span>&bull; Day 5 </span> - <a href="chap1-4.html"> "Working like a team"</a><br>
<div class="divider"></div>
<strong>After Hours Week 1</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours1-1.html">"History Lesson"</a><br>
<div class="divider"></div>
<strong>Week 2</strong><br>
<span>&bull; Day 1 </span> - <a href="chap2-1.html"> "We are coders, we use Git!"</a><br>
<span>&bull; Day 2 </span> - <a href="chap2-2.html"> "Making commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap2-3.html"> "Let's do this right, not fast"</a><br>
<span>&bull; Summary </span> - <a href="chap2-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 2</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours2-1.html">"A Little Of Git's Internals"</a><br>
<div class="divider"></div>
<strong>Week 3</strong><br>
<span>&bull; Day 1 </span> - <a href="chap3-1.html"> "How do I see what's going on?"</a><br>
<span>&bull; Day 2 </span> - <a href="chap3-2.html"> "But I need more information"</a><br>
<span>&bull; Day 3 </span> - <a href="chap3-3.html"> "What actually changed?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap3-4.html"> "Finding a good reference point"</a><br>
<span>&bull; Day 5 </span> - <a href="chap3-5.html"> "Putting things back again"</a><br>
<span>&bull; Summary </span> - <a href="chap3-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 3</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours3-1.html">"A Closer Look At Diffs and Tags"</a><br>
<div class="divider"></div>
<strong>Week 4</strong><br>
<span>&bull; Day 1 </span> - <a href="chap4-1.html"> "We're getting somewhere"</a><br>
<span>&bull; Day 2 </span> - <a href="chap4-2.html"> "Branches galore"</a><br>
<span>&bull; Day 3 </span> - <a href="chap4-3.html"> "Tricking the twigs"</a><br>
<span>&bull; Day 4 </span> - <a href="chap4-4.html"> "I pressed delete..."</a><br>
<span>&bull; Day 5 </span> - <a href="chap4-5.html"> "Conflicting information"</a><br>
<span>&bull; Summary </span> - <a href="chap4-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 4</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-1.html">"Merge merge merge"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-2.html">"Grepping your life away"</a><br>
<div class="divider"></div>
<strong>Week 5</strong><br>
<span>&bull; Day 1 </span> - <a href="chap5-1.html"> "This isn't working for me John"</a><br>
<span>&bull; Day 2 </span> - <a href="chap5-2.html"> "Back to logging"</a><br>
<span>&bull; Day 4 </span> - <a href="chap5-3.html"> "Advanced Techniques"</a><br>
<span>&bull; Summary </span> - <a href="chap5-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 5</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours5-1.html">"Splitting up commits the easy way"</a><br>
<div class="divider"></div>
<strong>Week 6</strong><br>
<span>&bull; Day 1 </span> - <a href="chap6-1.html"> "My private little stash"</a><br>
<span>&bull; Day 2 </span> - <a href="chap6-2.html"> "What?! No backup?"</a><br>
<span>&bull; Day 3 </span> - <a href="chap6-3.html"> "Is this clone for real?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap6-4.html"> "Help I'm no longer up to date?"</a><br>
<span>&bull; Day 5 </span> - <a href="chap6-5.html"> "I'm putting my foot down"</a><br>
<span>&bull; Summary </span> - <a href="chap6-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 6</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-1.html">"Tug of war"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-2.html">"Referring to objects"</a><br>
<div class="divider"></div>
<strong>Week 7</strong><br>
<span>&bull; Day 1 </span> - <a href="chap7-1.html"> "Networking with a difference"</a><br>
<span>&bull; Day 2 </span> - <a href="chap7-2.html"> "Now let's work together"</a><br>
<span>&bull; Day 3 </span> - <a href="chap7-3.html"> "Rebasing our commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap7-4.html"> "Starting to get rebased"</a><br>
<span>&bull; Day 5 </span> - <a href="chap7-5.html"> "I could rebase the world"</a><br>
<span>&bull; Summary </span> - <a href="chap7-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 7</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours7-1.html">"Network Communicating"</a><br>
<div class="divider"></div>
<strong>Week 8</strong><br>
<span>&bull; Day 1 </span> - <a href="chap8-1.html"> "Give a man a patch"</a><br>
<span>&bull; Day 2 </span> - <a href="chap8-2.html"> "Looking for problems"</a><br>
<span>&bull; Day 3 </span> - <a href="chap8-3.html"> "Filtered repos"</a><br>
<span>&bull; Day 4 </span> - <a href="chap8-4.html"> "Let's make a library"</a><br>
<span>&bull; Day 5 </span> - <a href="chap8-5.html"> "Shhh....we're in a library"</a><br>
<span>&bull; Summary </span> - <a href="chap8-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 8</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours8-1.html">"Fishing for beginners"</a><br>
<div class="divider"></div>
<strong>A little extra help</strong><br>
&bull;&nbsp;&nbsp;<a href="chap9-1.html">Taking things further</a><br>
&bull;&nbsp;&nbsp;<a href="chap9-2.html">The end of the journey</a><br>
<div class="divider"></div>

				
				<td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table>              <h1>&nbsp;</h1>
              </td>
            <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="read_content">
<h1>Week 7</h1><h2>Day 3 - "Rebasing our commitments"</h2>
<h3>Rebase examples</h3>
We are now going to go back to our <code class="ncode">coderepo</code> folder.
This is the one we cloned from in Week 6 to create the <code class="ncode">coderepo-cl</code> repository.
When we left this repository, we were at commit <strong>1c3206a</strong>.
If you have played with the repository at all, it would be a good opportunity for you to bring the wonderful branch to that point.
We are also going to Fast Forward the master branch to that same point to.
Before reading on, try to remember what commands we would use to do this and then check below to see if you are right.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout wonderful<br></strong>
Already on 'wonderful'<br>
<strong>john@satsuki:~/coderepo$ git reset --hard 1c3206a<br></strong>
HEAD is now at 1c3206a Added a new file<br>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br>So we begin by ensuring that we are on the <strong>wonderful</strong> branch.
Then we perform a hard reset, to ensure that the HEAD of <strong>wonderful</strong> points to the commit <strong>1c3206a</strong>.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout master<br></strong>
Switched to branch 'master'<br>
<strong>john@satsuki:~/coderepo$ git merge wonderful<br></strong>
Updating 37950f8..1c3206a<br>
Fast-forward<br>
 newfile3 |    1 +<br>
 1 files changed, 1 insertions(+), 0 deletions(-)<br>
 create mode 100644 newfile3<br>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br>Next we use the <code class="ncode">git merge</code> command as before to bring the <strong>master</strong> branch in line with the <strong>wonderful</strong> branch.
As there have been no more commits to <strong>master</strong> since we worked on <strong>wonderful</strong>, it means that once again, the merge can be a simple Fast Forward merge, allowing us to simple change which commit HEAD points to within the <strong>master</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git branch -v<br></strong>
  master    1c3206a Added a new file<br>
* wonderful 1c3206a Added a new file<br>
  zaney     7cc32db Made another awesome change<br>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br>Finally, we run a <code class="ncode">git branch</code> command to confirm that the branches point to the same commit.
Remember there are other ways we could have achieved this, using <code class="ncode">git log</code> for example.
Now that we can see they point to the same place, we can continue with our introduction to the <code class="ncode">git rebase</code> command.
We will start by making some commits to the <strong>wonderful</strong> branch and see how we can update our underlying master branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ echo "New Changes" &gt;&gt; another_file<br></strong>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Updated another file'<br></strong>
[wonderful c0e2f5b] Updated another file<br>
 1 files changed, 1 insertions(+), 0 deletions(-)<br>
<strong>john@satsuki:~/coderepo$ echo "More New Changes" &gt;&gt; another_file<br></strong>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Updated another file'<br></strong>
[wonderful 8c6a66b] Updated another file<br>
 1 files changed, 1 insertions(+), 0 deletions(-)<br>
<strong>john@satsuki:~/coderepo$ echo "More Super New Changes" &gt;&gt; another_file<br></strong>
<strong>john@satsuki:~/coderepo$ git commit -a -m 'Updated another file again'<br></strong>
[wonderful b91ec84] Updated another file again<br>
 1 files changed, 1 insertions(+), 0 deletions(-)<br>
<strong>john@satsuki:~/coderepo$ gitk --all<br></strong>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br>Before we continue, there is a problem in the trenches.<br><div id="trenchblock"><strong>In the trenches...</strong><br>
"Ahh dang it" shouted Simon.
"That's really not very helpful to anyone."<br><br>"What's up?" said Martha over the cubicle wall.
She stood up, knocking a pile of papers over that were hanging precariously on the edge of the desk.
They scattered across the floor creating a white dividing line down the middle of the office.
She mutter something under her breath.
John and Simon began to help tidy the papers up whilst Simon started stating his problem.<br><br>"Well, I commit two commits that used the same commit message, I really wasn't thinking. Plus the fact that they should really have been one commit."<br><br>"Just reset back and do the work again," shouted an eavesdropping Klaud unhelpfully.
A round of raised eyebrows circled the paper-stackers.<br><br>"You could use rebase." Martha was standing next to the desk now and was arranging the stack in a more suitable position on the desk.<br><br>"How so?" John looked at Martha inquisitively.<br><br>Martha giggled.
"Rebase can do a lot more than just replaying commits you know. Some of the more simpler tasks are ... well ... let me show you."
</div><br>Looking at our example commits, it would appear that we have made the same mistake as Simon.
Our commits, <strong>c0e2f5b</strong> and <strong>8c6a66b</strong> have got the same commit message.
Not very helpful at all.
Let us see how <code class="ncode">git rebase</code> can help us out here.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git rebase -i HEAD~3<br></strong>
</code></div><br>We have told Git to run the <code class="ncode">rebase</code> command using the <code class="ncode">-i</code> parameter.
This will put Git into <em>interactive</em> mode.
We have also asked Git to rebase the last three commits.
The <code class="ncode">HEAD~3</code> is used like before to tell us to go back three commits from the HEAD references.
When we run this command, we are presented with a text file in our default text editor.<br><div id="codeblock"><code>pick c0e2f5b Updated another file<br>
pick 8c6a66b Updated another file<br>
pick b91ec84 Updated another file again<br>
<br>
# Rebase 1c3206a..b91ec84 onto 1c3206a<br>
#<br>
# Commands:<br>
#  p, pick = use commit<br>
#  r, reword = use commit, but edit the commit message<br>
#  e, edit = use commit, but stop for amending<br>
#  s, squash = use commit, but meld into previous commit<br>
#  f, fixup = like "squash", but discard this commit's log message<br>
#  x, exec = run command (the rest of the line) using shell<br>
#<br>
# If you remove a line here THAT COMMIT WILL BE LOST.<br>
# However, if you remove everything, the rebase will be aborted.<br>
#<br>
</code></div><br>At the top of the file, you can see the last three commits, along with their commit message, prefixed by the word pick.
We will get to what this really means in a few minutes, but as you can see there are a large number of options within the rebase interactive system.
If we closed the file and left it unchanged, the rebase would end without altering anything.
The options are fairly self explanitory but they allow us to change many elements of a commit or a series of commits.<br><br>In our case, we can use this to reword the second commit, <strong>8c6a66b</strong>.
We are going to modify the lines above to look like the ones below.<br><div id="codeblock"><code>pick c0e2f5b Updated another file<br>
r 8c6a66b Updated another file<br>
pick b91ec84 Updated another file again<br>
</code></div><br>Notice that we replaced the beginning of the second line, original starting with <code class="ncode">pick</code>, with the letter <code class="ncode">r</code>.
Using the list of available functions above, we can easily see that the <code class="ncode">r</code> corresponds to the <em>reword</em> function, which will allow us to change the wording that we have used for that particular commit.
On saving this and closing this file, Git quickly presents us with another editor window.
This time the window contains a more familiar commit message setup.
We will modify it to show the same as below, and then close the editor.<br><div id="codeblock"><code>Updated another file 2nd time<br>
<br>
# Please enter the commit message for your changes. Lines starting<br>
# with '#' will be ignored, and an empty message aborts the commit.<br>
# Not currently on any branch.<br>
# Changes to be committed:<br>
#   (use "git reset HEAD^1 &lt;file&gt;..." to unstage)<br>
#<br>
#       modified:   another_file<br>
#<br>
# Untracked files:<br>
#   (use "git add &lt;file&gt;..." to include in what will be committed)<br>
#<br>
#       temp_file<br>
</code></div><br>After Git completes working on the rebase, we are presented with the result of our operation.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git rebase -i HEAD~3<br></strong>
[detached HEAD 7c35dde] Updated another file 2nd time<br>
 1 files changed, 1 insertions(+), 0 deletions(-)<br>
Successfully rebased and updated refs/heads/wonderful.<br>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br>So Git has completed the operation, and by running an abbreviated <code class="ncode">git log</code> command, we can see that the fruits of our labour have resulted in the second commit having its working changed.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log --graph --pretty=oneline --all --abbrev-commit --decorate -n 4<br></strong>
* aeb5679 (HEAD, wonderful) Updated another file again<br>
* 7c35dde Updated another file 2nd time<br>
* c0e2f5b Updated another file<br>
* 1c3206a (master) Added a new file<br>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br><div id="calloutblock"><h3>Note - Rebasing and the hashes</h3>
If you have been paying attention to the SHA-1 hashes as we have been moving through this last piece on rebasing, you may have noticed something interesting.
Though there are commits that we have not altered at all, the commit IDs have indeed changed.
If we take the example where we re-worded the second commit, it is clear to see that subsequent commits have their IDs changed.
In the example, we modified commit <strong>8c6a66b</strong>, but we left <strong>b91ec84</strong> untouched.
In the resulting tree, both have had their IDs changed.<br><br>The reason for this is simple, remember we are replaying commits.
In a sense we are re-committing the changes that were made during that commit.
As we have stated previously, Git is cryptographically secure.
By this we mean that each commit relies on the commit that preceeds it.
So, if we change the ID of a preceeding commit, all subsequent ones have to change also.
</div><br>Let us try this rebase again.
This time we will use the squash option to merge the two similar commits into one.
We will run the same command as before; <code class="ncode">git rebase -i HEAD~3</code>.
This time we will use the <code class="ncode">s</code> prefix to the line to choose <em>squashing</em> as our method.
We could have used the word <code class="ncode">squash</code> instead of <code class="ncode">s</code>, but for the laziness in all of us, we will opt for the single letter versions for now.<br><div id="codeblock"><code>pick c0e2f5b Updated another file<br>
s 7c35dde Updated another file 2nd time<br>
pick aeb5679 Updated another file again<br>
<br>
# Rebase 1c3206a..aeb5679 onto 1c3206a<br>
</code></div><br>Now when we save and close the file, we are presented with a slightly different screen.
As we are squashing several commits together into one, we need to choose a commit message.
The message needs to be descriptive enough that it will accturately let a developer see what has been updated in this single commit.
We will delete these lines and replace them with the comment <code class="ncode">Updated another file with 2 edits</code>.<br><div id="codeblock"><code># This is a combination of 2 commits.<br>
# The first commit's message is:<br>
<br>
Updated another file<br>
<br>
# This is the 2nd commit message:<br>
<br>
Updated another file 2nd time<br>
</code></div><br>After completion, Git shows us that the rebase has been successful.<br><div id="codeblock"><code>[detached HEAD 1ffe37f] Updated another file with 2 edits<br>
 1 files changed, 2 insertions(+), 0 deletions(-)<br>
Successfully rebased and updated refs/heads/wonderful.<br>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br>By using the <code class="ncode">git log</code> message, we can see that the two commits have indeed been replaced by one.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log --graph --pretty=oneline --all --abbrev-commit --decorate -n 4<br></strong>
* 4d91aab (HEAD, wonderful) Updated another file again<br>
* 1ffe37f Updated another file with 2 edits<br>
* 1c3206a (master) Added a new file<br>
* 37950f8 Continued Development<br>
<strong>john@satsuki:~/coderepo$<br></strong>
</code></div><br><div id="trenchblock"><strong>In the trenches...</strong><br>
"Actually that's pretty cool," commented Simon, after Martha had shown him how to use rebase to squash and reword.
She smiled, but said nothing.
Martha had an uncanny knack for knowing when there was going to be another question.
"So, just how would we use git rebase for keeping a development tree up to date?"<br><br>Martha ruffled Simon's hair.
She liked his youthful enthusiasm.
"How about we take a crack at that tomorrow eh?"
</div><br><table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><p align="left"><a href="chap7-2.html"><img src="images/prev.png" alt="Previous Day" height="29"></a></p></td>
						<td><p align="right"><a href="chap7-4.html"><img src="images/next.png" alt="Next Day" height="29"></a></p></td>
					</tr>
				</table>                  </td>
                <td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table></td>
            </tr>
          </table>
		</td>
      </tr>
      <tr>
        <td class="foot"><a href="index.html">home</a> | <a href="download.html">download</a> | <a href="read.html">read now</a> | <a href="source.html">source</a> | <a href="feedback.html">feedback</a> | <a href="legal.html">legal stuff</a><br>
        </td>
      </tr>
    </table></td>
  </tr>
</table>
</body>
</html>
