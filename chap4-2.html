<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Git In The Trenches</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<link type="text/css" href="menu.css" rel="stylesheet" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-228354-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<table width="1000" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td class="logo"><a href="index.html"><img src="images/git_logo_new.png" alt="Git In The Trenches" height="61" border="0"></a></td>
            <td class="nav">
				<a href="index.html">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="download.html">Download Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="intro.html">Read Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="http://github.com/cbx33/gitt">Source</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="feedback.html">Feeback</a>
			</td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td class="main_content_pad"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="309"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="subnav">
				<strong>Introduction</strong><br>
&bull;&nbsp;&nbsp;<a href="intro.html">How this book works</a><br>
<div class="divider"></div>
<strong>Setting up</strong><br>
&bull;&nbsp;&nbsp;<a href="setup.html">Making sure you have everything</a><br>
<div class="divider"></div>
<strong>Week 1</strong><br>
<span>&bull; Day 1 </span> - <a href="chap1-1.html"> "Things need to change"</a><br>
<span>&bull; Day 3 </span> - <a href="chap1-2.html"> "A possible solution"</a><br>
<span>&bull; Day 4 </span> - <a href="chap1-3.html"> "A decision is reached"</a><br>
<span>&bull; Day 5 </span> - <a href="chap1-4.html"> "Working like a team"</a><br>
<div class="divider"></div>
<strong>After Hours Week 1</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours1-1.html">"History Lesson"</a><br>
<div class="divider"></div>
<strong>Week 2</strong><br>
<span>&bull; Day 1 </span> - <a href="chap2-1.html"> "We are coders, we use Git!"</a><br>
<span>&bull; Day 2 </span> - <a href="chap2-2.html"> "Making commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap2-3.html"> "Let's do this right, not fast"</a><br>
<span>&bull; Summary </span> - <a href="chap2-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 2</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours2-1.html">"A Little Of Git's Internals"</a><br>
<div class="divider"></div>
<strong>Week 3</strong><br>
<span>&bull; Day 1 </span> - <a href="chap3-1.html"> "How do I see what's going on?"</a><br>
<span>&bull; Day 2 </span> - <a href="chap3-2.html"> "But I need more information"</a><br>
<span>&bull; Day 3 </span> - <a href="chap3-3.html"> "What actually changed?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap3-4.html"> "Finding a good reference point"</a><br>
<span>&bull; Day 5 </span> - <a href="chap3-5.html"> "Putting things back again"</a><br>
<span>&bull; Summary </span> - <a href="chap3-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 3</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours3-1.html">"A Closer Look At Diffs and Tags"</a><br>
<div class="divider"></div>
<strong>Week 4</strong><br>
<span>&bull; Day 1 </span> - <a href="chap4-1.html"> "We're getting somewhere"</a><br>
<span>&bull; Day 2 </span> - <a href="chap4-2.html"> "Branches galore"</a><br>
<span>&bull; Day 3 </span> - <a href="chap4-3.html"> "Tricking the twigs"</a><br>
<span>&bull; Day 4 </span> - <a href="chap4-4.html"> "I pressed delete..."</a><br>
<span>&bull; Day 5 </span> - <a href="chap4-5.html"> "Conflicting information"</a><br>
<span>&bull; Summary </span> - <a href="chap4-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 4</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-1.html">"Merge merge merge"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-2.html">"Grepping your life away"</a><br>
<div class="divider"></div>
<strong>Week 5</strong><br>
<span>&bull; Day 1 </span> - <a href="chap5-1.html"> "This isn't working for me John"</a><br>
<span>&bull; Day 2 </span> - <a href="chap5-2.html"> "Back to logging"</a><br>
<span>&bull; Day 4 </span> - <a href="chap5-3.html"> "Advanced Techniques"</a><br>
<span>&bull; Summary </span> - <a href="chap5-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 5</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours5-1.html">"Splitting up commits the easy way"</a><br>
<div class="divider"></div>
<strong>Week 6</strong><br>
<span>&bull; Day 1 </span> - <a href="chap6-1.html"> "My private little stash"</a><br>
<span>&bull; Day 2 </span> - <a href="chap6-2.html"> "What?! No backup?"</a><br>
<span>&bull; Day 3 </span> - <a href="chap6-3.html"> "Is this clone for real?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap6-4.html"> "Help I'm no longer up to date?"</a><br>
<span>&bull; Day 5 </span> - <a href="chap6-5.html"> "I'm putting my foot down"</a><br>
<span>&bull; Summary </span> - <a href="chap6-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 6</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-1.html">"Tug of war"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-2.html">"Referring to objects"</a><br>
<div class="divider"></div>
<strong>Week 7</strong><br>
<span>&bull; Day 1 </span> - <a href="chap7-1.html"> "Networking with a difference"</a><br>
<span>&bull; Day 2 </span> - <a href="chap7-2.html"> "Now let's work together"</a><br>
<span>&bull; Day 3 </span> - <a href="chap7-3.html"> "Rebasing our commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap7-4.html"> "Starting to get rebased"</a><br>
<span>&bull; Day 5 </span> - <a href="chap7-5.html"> "I could rebase the world"</a><br>
<span>&bull; Summary </span> - <a href="chap7-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 7</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours7-1.html">"Network Communicating"</a><br>
<div class="divider"></div>
<strong>Week 8</strong><br>
<span>&bull; Day 1 </span> - <a href="chap8-1.html"> "Give a man a patch"</a><br>
<span>&bull; Day 2 </span> - <a href="chap8-2.html"> "Looking for problems"</a><br>
<span>&bull; Day 3 </span> - <a href="chap8-3.html"> "Filtered repos"</a><br>
<span>&bull; Day 4 </span> - <a href="chap8-4.html"> "Let's make a library"</a><br>
<span>&bull; Day 5 </span> - <a href="chap8-5.html"> "Shhh....we're in a library"</a><br>
<span>&bull; Summary </span> - <a href="chap8-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 8</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours8-1.html">"Fishing for beginners"</a><br>
<div class="divider"></div>
<strong>A little extra help</strong><br>
&bull;&nbsp;&nbsp;<a href="chap9-1.html">Taking things further</a><br>
&bull;&nbsp;&nbsp;<a href="chap9-2.html">The end of the journey</a><br>
<div class="divider"></div>

				
				<td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table>              <h1>&nbsp;</h1>
              </td>
            <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="read_content">
<h1>Week 4</h1><h2>Day 2 - "Branches galore"</h2>
<h3>Working with branches</h3>
Now we know about branches in general, we should really learn about how to merge changes from one branch into another.
Branches are fantastic for trying new things out and testing ideas, but if those ideas are successful, we need a way of pulling those changes into our <strong>master</strong> branch.<br><br>Of course we could do this the old fashioned way.
We could switch into our <strong>wacky</strong> branch, do a little development, copy the files somewhere else, switch to our <strong>master</strong> branch, and paste the files over the top.
Now, this is probably the simplest way of merging possible.
In actual fact, this is not really merging at all.
However one thing that would be lost is the history of how that branch has developed over time.
Sometimes this can be crucial for knowing why certain things were changed during the development process.<br><br>Let us take a little look at the command output of a simple merge, explain it a little, and then look at a diagrammatic representation.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git branch</strong><br/>
  master<br/>
* wacky<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Firstly we check just to see what branch we are on.
Next we checkout the branch we want our development branch to be merged into.
In this case, we want to merge <strong>wacky</strong> into <strong>master</strong> and so we must first checkout the <strong>master</strong> branch.
Then we can merge in the changes from our <strong>wacky</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout master</strong><br/>
Switched to branch 'master'<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Now we can run the actual merge.
<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git merge wacky</strong><br/>
Updating a022d4d..9710177<br/>
Fast-forward<br/>
 another_file             |    1 +<br/>
 my_first_committed_file  |    1 -<br/>
 my_second_committed_file |    1 -<br/>
 newfile1                 |    1 +<br/>
 newfile2                 |    1 +<br/>
 5 files changed, 3 insertions(+), 2 deletions(-)<br/>
 create mode 100644 another_file<br/>
 delete mode 100644 my_first_committed_file<br/>
 delete mode 100644 my_second_committed_file<br/>
 create mode 100644 newfile1<br/>
 create mode 100644 newfile2<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>We can see that the first line after our <code class="ncode">git merge</code> command shows us which commit <strong>master</strong> is the latest common ancestor to both branches and then which commit is the last in our new branch.
In this case we are merging from <strong>a022d4d</strong> to <strong>9710177</strong>.
The line below this is even more important.
This type of merge is called a <em>fast-forward</em> merge.
We have not made any changes to our <strong>master</strong> branch since we began developing and subsequently, after finishing our development work, we literally only require fast-forwarding the <strong>master</strong> branch to the same point in time as our <strong>wacky</strong> one.
Beneath this text, we see more information about just what is included in the merge.<br><br>We are going to perform a quick check, to see that we are in fact on the master branch and that the latest log message is the one from the point we last left the <strong>wacky</strong> branch.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log -n1</strong><br/>
commit 9710177657ae00665ca8f8027b17314346a5b1c4<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Fri Apr 1 00:16:17 2011 +0100<br/>
<br/>
    Added another file<br/>
<strong>john@satsuki:~/coderepo$ git branch</strong><br/>
* master<br/>
  wacky<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Now let us take a quick look at a diagram to see how this change actually affected the commit flow.
We have included tags in this diagram, so that you can see where they point to as well.<br><center><table  border="0" cellpadding="0" cellspacing="0" class="image_float_left">
                    <tr>
                      <td style="padding:10px;"><img src="images/chaps/f-w4-d2.png" width="400" ></td>
                      <td class="fade_right">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="fade_bot_image"><div align="center"><strong>Figure 2</strong><br>Our first merge</div></td>
                      <td class="fade_corner">&nbsp;</td>
                    </tr>
                  </table></center><br>This picture should make it clear that the fundamental difference between tags and branches is that whilst the pointer to a branch moves with each commit to that branch, a tag points to a single commit only and never changes, unless forcibly so by the user.<br><br>There are a number of tricks that we can employ when using branches.
They are possible because of the super flexible way in which branches are implemented in Git.
As a branch is literally a pointer to a commit, certain operations are available to a user that other systems just can not implement.
However, we should point something out at this point.
Even though we have not yet made any of our repositories public or available to other people, something should always be in the back of your mind.
Allow a few minutes to read the next few paragraphs below.<br><br>As someone once said, "With great power, comes great responsibility." Git is hugely powerful.
However, with this power comes a certain level of responsibility.
We are referring here to Git's ability to change history.
If you have watched any science fiction films involving time travel, you should be aware of the difficulties and problems often associated with time travel.
In Git, the same rule applies and the basics of the rule boil down to this: <strong>If you have made a commit, or path of commits available, you should never ever change anything in the history of those commits or the commits themselves.</strong><br>If you are wondering why this is so important, consider this.
If you are making a series of films, and you have already released the first two of a trilogy, you would not put elements in the third one that contradict the history of the others.
You can not just act like the history of the first two did not happen.
Occasionally this happens in the film industry and what is the reaction of the public? People get mad.
Sometimes very mad.
This is what will happen if you do the same with Git.
People who are using your repository will end up with many problems and inconsistencies.
<strong>Do NOT do it, ever</strong>.
There are ways to revert certain behaviour and we will cover this at a later stage.<br><br>Having said this, you should not shy away from the awesome capabilities of Git.
We are going to cover a few situations now which you may find yourself in.
Some of them do alter history, some of them do not.
This is why it is important to have an understanding of how Git works.
It can be your best friend, but it can also cause you issues.
If you take the time to tame the beast, it will be one of the most awesome tools in your developers tool bag and can save your life time and time again.<br><div id="trenchblock"><strong>In the trenches...</strong><br>
"Oh man." The familiar cry of Simon needing something reverberated round the office.
Rob could never understand why he didn't ask for help.
Simon would sit there wallowing out loud until someone could take it no longer and would eventually go over and help him.<br><br>"What to do... what to do."<br><br>Rob could take it no more.
Simon had been exclaiming now for about five minutes and Rob seemed to either be the only one who wasn't listening to music, or who was getting annoyed.
He rolled his eyes, "What's up Si?"<br><br>Simon grinned inanely to himself.
"I just started modifying some files and well ... I don't want to get rid of them ... I'm not 100
"Well, when did you last commit?"<br><br>"Just before I started all this work," came the reply.<br><br>Rob pointed at Simon's screen.
"You can just create a new branch now and move all the changes into it in one go. You can do it in one command actually."
</div><br>It is one hundred percent true.
How many times have you been working on something and wished that you could move all the changes you had made to a new safe environment to protect your already good, working code.
Well, the new safe environment we spoke of sounds suspiciously like a branch.
In Git, any changes you have in your working copy can be taken into a new branch by issuing one command.
It is important to note that these changes can also be taken into an existing branch, but you may run into problems if those changes conflict with items already in that branch.<br><br>For now let us see how we can take our working copy changes into a new branch to continue development of some wonderful new feature.
We are going to start by making some changes to our newfiles.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ echo "and some more changes" &gt;&gt; newfile1</strong><br/>
<strong>john@satsuki:~/coderepo$ echo "and a new feature" &gt;&gt; newfile2</strong><br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Now we are going to make a new branch and switch into it.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git checkout -b wonderful</strong><br/>
M	newfile1<br/>
M	newfile2<br/>
Switched to a new branch 'wonderful'<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>Did you see that? We managed to create a new branch and move into it in one go.
The <code class="ncode">git checkout</code> command is usually what we would use to move into a branch, not create it.
When we use the <code class="ncode">-b</code> parameter, the <code class="ncode">git checkout</code> command can be used to create a new branch and switch to it in one go.
Notice we have chosen the name <strong>wonderful</strong> for this particular branch.
There is also a status output below this that shows we have pulled two modifications into this branch, denoted by the letter <code class="ncode">M</code> in front of the file name.<br><br>Now we can commit these changes.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git commit -a -m 'Fantastic new feature'</strong><br/>
[wonderful cfbecab] Fantastic new feature<br/>
 2 files changed, 2 insertions(+), 0 deletions(-)<br/>
<strong>john@satsuki:~/coderepo$ git diff master wonderful</strong><br/>
diff --git a/newfile1 b/newfile1<br/>
index 24e7dfa..ef20984 100644<br/>
--- a/newfile1<br/>
+++ b/newfile1<br/>
@@ -1 +1,2 @@<br/>
 A new file<br/>
+and some more changes<br/>
diff --git a/newfile2 b/newfile2<br/>
index cba16cc..dac4357 100644<br/>
--- a/newfile2<br/>
+++ b/newfile2<br/>
@@ -1 +1,2 @@<br/>
 Another new file<br/>
+and a new feature<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>After running the diff, we can see the differences between the <strong>master</strong> and the <strong>wonderful</strong> branches.
Looking more closely at the hunks, the only differences between the two branches are those that we made before we created our <strong>wonderful</strong> branch.
We have achieved what we set out to in bringing uncommitted changes from <strong>master</strong> into <strong>wonderful</strong> and subsequently committing them.<br><br><table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><p align="left"><a href="chap4-1.html"><img src="images/prev.png" alt="Previous Day" height="29" border="0"></a></p></td>
						<td><p align="right"><a href="chap4-3.html"><img src="images/next.png" alt="Next Day" height="29" border="0"></a></p></td>
					</tr>
				</table>                  </td>
                <td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table></td>
            </tr>
          </table>
		</td>
      </tr>
      <tr>
        <td class="foot"><a href="index.html">home</a> | <a href="download.html">download</a> | <a href="intro.html">read now</a> | <a href="http://github.com/cbx33/gitt">source</a> | <a href="feedback.html">feedback</a> | <a href="legal.html">legal stuff</a><br>
        </td>
      </tr>
    </table></td>
  </tr>
</table>
</body>
</html>
